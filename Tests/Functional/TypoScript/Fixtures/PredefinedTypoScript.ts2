#######################
# PREDEFINED TYPOSCRIPT
#######################

#
# TYPO3.TypoScript
#

prototype(TYPO3.TypoScript:Array).@class = 'TYPO3\\TypoScript\\TypoScriptObjects\\ArrayImplementation'
prototype(TYPO3.TypoScript:Template).@class = 'TYPO3\\TypoScript\\TypoScriptObjects\\TemplateImplementation'
prototype(TYPO3.TypoScript:Collection).@class = 'TYPO3\\TypoScript\\TypoScriptObjects\\CollectionImplementation'
prototype(TYPO3.TypoScript:Case).@class = 'TYPO3\\TypoScript\\TypoScriptObjects\\CaseImplementation'
prototype(TYPO3.TypoScript:Matcher).@class = 'TYPO3\\TypoScript\\TypoScriptObjects\\MatcherImplementation'
prototype(TYPO3.TypoScript:Value).@class = 'TYPO3\\TypoScript\\TypoScriptObjects\\ValueImplementation'


#
# TYPO3.Neos
#

prototype(TYPO3.Neos:ContentCase) < prototype(TYPO3.TypoScript:Case) {
	default {
		@position = 'end'
		condition = ${true}
		type = ${q(node).property('_nodeType.name')}
	}
}

prototype(TYPO3.Neos:Template) < prototype(TYPO3.TypoScript:Template) {
	node = ${node}
}

prototype(TYPO3.Neos:ContentCollection) < prototype(TYPO3.TypoScript:Collection) {
	@class = 'TYPO3\\Neos\\TypoScript\\ContentCollectionImplementation'

	nodePath = 'to-be-set-by-user'

		# To enable direct rendering of a ContentCollection we check if the current node is a
		# content collection already or if the child nodes of a content collection specified by
		# nodePath should be rendered
	collection = ${q(node).is('[instanceof TYPO3.Neos:ContentCollection]') ? q(node).children() : q(node).children(this.nodePath).children()}

	itemName = 'node'
	itemRenderer = TYPO3.Neos:ContentCase
}


# TYPO3.Neos:Page is the default object used for rendering in most sites
#
prototype(TYPO3.Neos:Page) < prototype(TYPO3.TypoScript:Array) {

	doctype = '<!DOCTYPE html>'
	doctype.@position = 'start 100'

	# Only the opening html tag for the page. This is done to avoid deep nesting of TypoScript paths for integrators.
	htmlTag = TYPO3.TypoScript:Tag {
		@position = 'start'
		tagName = 'html'
		omitClosingTag = TRUE

		attributes {
			version = 'HTML+RDFa 1.1'
			xmlns = 'http://www.w3.org/1999/xhtml'
			xmlns:typo3 = 'http://www.typo3.org/ns/2012/Flow/Packages/Neos/Content/'
			xmlns:xsd = 'http://www.w3.org/2001/XMLSchema#'
		}
	}

	headerComment = Template {
		@position = 'after htmlTag 10'
		templatePath = 'resource://TYPO3.Neos/Private/Templates/TypoScriptObjects/NeosLicenseHeader.html'
	}

	# The opening head tag for the page. This is done to avoid deep nesting of TypoScript paths for integrators.
	headTag = TYPO3.TypoScript:Tag {
		@position = '10'
		tagName = 'head'
		omitClosingTag = TRUE
	}

	# The content of the head tag, integrators can add their own head content in this array.
	head = TYPO3.TypoScript:Array
	head {
		@position = 'after headTag'

		characterSetMetaTag = TYPO3.TypoScript:Tag {
			tagName = 'meta'
			attributes {
				charset = 'UTF-8'
			}
		}

		neosBackendHeader = TYPO3.Neos:Template {
			templatePath = 'resource://TYPO3.Neos/Private/Templates/TypoScriptObjects/NeosBackendHeaderData.html'
		}
	}

	closingHeadTag = '</head>'
	closingHeadTag.@position = 'after head'

	# The opening body tag for the page. This is done to avoid deep nesting of TypoScript paths for integrators.
	bodyTag = TYPO3.TypoScript:Tag {
		@position = '20'
		tagName = 'body'
		omitClosingTag = TRUE
	}

	# Content of the body tag. To be defined by the integrator.
	body = Template
	body.@position = '100'

	closingBodyTag = '</body>'
	closingBodyTag.@position = 'end'

	closingHtmlTag = '</html>'
	closingHtmlTag.@position = 'end 100'
}


prototype(TYPO3.Neos:Plugin).@class = 'TYPO3\\Neos\\TypoScript\\PluginImplementation'

root = TYPO3.TypoScript:Case
root {
	format {
		@position = 'end 9998'
		condition = ${request.format != 'html'}
		renderPath = ${'/' + String.replace(request.format, '.', '/')}
	}

	default {
		@position = 'end 9999'
		condition = ${true}
		renderPath = '/page'
	}
}


#
# TYPO3.Neos.NodeTypes
#

prototype(TYPO3.Neos.NodeTypes:Html) < prototype(TYPO3.Neos:Template)
prototype(TYPO3.Neos.NodeTypes:Html) {
	templatePath = 'resource://TYPO3.Neos.NodeTypes/Private/Templates/TypoScriptObjects/Html.html'
	source = ${q(node).property('source')}
}

prototype(TYPO3.Neos.NodeTypes:Headline) < prototype(TYPO3.Neos:Template)
prototype(TYPO3.Neos.NodeTypes:Headline) {
	templatePath = 'resource://TYPO3.Neos.NodeTypes/Private/Templates/TypoScriptObjects/Headline.html'
	title = ${q(node).property('title')}
}

prototype(TYPO3.Neos.NodeTypes:Text) < prototype(TYPO3.Neos:Template)
prototype(TYPO3.Neos.NodeTypes:Text) {
	templatePath = 'resource://TYPO3.Neos.NodeTypes/Private/Templates/TypoScriptObjects/Text.html'
	text = ${q(node).property('text')}
}
